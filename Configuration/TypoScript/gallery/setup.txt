tt_content.tx_contentdesigner_gallery < plugin.tx_contentdesigner
tt_content.tx_contentdesigner_gallery.settings {
  title       = LLL:EXT:content_designer/Resources/Private/Language/locallang_db.xml:gallery_title
  description = LLL:EXT:content_designer/Resources/Private/Language/locallang_db.xml:gallery_description
  
  icon      = ../typo3conf/ext/content_designer/Resources/Public/Icons/Gallery/galleryBig.png
  iconSmall = ../typo3conf/ext/content_designer/Resources/Public/Icons/Gallery/gallerySmall.png
  
  # Overwrite the TCA Label Field for List module and so on
  # Priority in order as follows: userFunc, field, static value
  altLabelField          = Static Label
  altLabelField.field    = description
  altLabelField.userFunc = EXT:content_designer/Resources/Private/LabelUserFunc/user_labelexample.class.php:user_labelexample->getUserLabel
  
  cObject.sDEF.sheetTitle = LLL:EXT:content_designer/Resources/Private/Language/locallang_db.xml:sheet_general
  cObject.sDEF.el {  
    prevImage {
      label = LLL:EXT:content_designer/Resources/Private/Language/locallang_db.xml:gallery_previmage
      
      config {
        type          = group
        internal_type = file
        allowed       = jpg,gif,png,jpeg
        show_thumbs   = 1
        uploadfolder  = uploads/tx_contentdesigner/
        size          = 1
        minitems      = 1
        maxitems      = 1
      }
    }
    
    description {
      label = LLL:EXT:content_designer/Resources/Private/Language/locallang_db.xml:gallery_descriptiontext
      
      config.type = text
    }
    
    reference {
      label = LLL:EXT:content_designer/Resources/Private/Language/locallang_db.xml:gallery_imageset
      
      config {
        type                = inline
        foreign_table       = sys_file_collection
        foreign_table_where = ORDER BY sys_file_collection.title
        multiple            = 0
        size                = 1
        autoSizeMax         = 30
        minitems            = 0
        maxitems            = 1
      }
    }
  }
  
  renderObj >
  renderObj = COA
  renderObj {
    10 = TEXT
    10.value =
    
    # Overview
    20 = COA
    20.if.isFalse.data = GP:show
    20.1 = FLUIDTEMPLATE
    20.1 {
      file = EXT:content_designer/Resources/Private/Templates/Gallery/Teaser.html
      
      variables {
        header       = TEXT
        header.field = header
        
        prevImage       = TEXT
        prevImage.field = prevImage
        prevImage.wrap  = uploads/tx_contentdesigner/
        
        description       = TEXT
        description.field = description
      }
    }
    
    # Detailview
    30 = COA
    30.if.value.field = uid
    30.if.equals.data = GP:show
    30.1 = FLUIDTEMPLATE
    30.1 {
      file = EXT:content_designer/Resources/Private/Templates/Gallery/Show.html
      
      variables {
        header       = TEXT
        header.field = header
        
        prevImage       = TEXT
        prevImage.field = prevImage
        prevImage.wrap  = uploads/tx_contentdesigner/
        
        description       = TEXT
        description.field = description
        
        images = FILES
        images {
          collections.field = reference
          
          renderObj = IMAGE
          renderObj {
            wrap = <div class="gallery-single-image">|</div>
            
            file.import.data = file:current:publicUrl
            file.maxW = 130c
            
            imageLinkWrap = 1
            imageLinkWrap.enable = 1
            imageLinkWrap.typolink {
              parameter.cObject = IMG_RESOURCE
              parameter.cObject {
                file.import.data = file:current:publicUrl
                file.width = 640m
                file.height = 480m
              }
              
              ATagParams.stdWrap.dataWrap = class="lightbox" rel="lightbox[{field:uid}]"
            }
          }
        }
      }
    }
  }
  
#  previewObj = COA
#  previewObj {
#    10 = TEXT
#    10.field = description
#    10.wrap = |<br>
#    
#    # Works fine in Typo3 v6.2
#    20 = IMG_RESOURCE
#    20.file.import.field = prevImage
#    20.file.import = uploads/tx_contentdesigner/
#    20.file.width = 70m
#    20.stdWrap.wrap = <img src="../../../../|" /><br>
#  }
}

plugin.tx_contentdesigner._CSS_DEFAULT_STYLE (
  div.gallery-single-image {
    display: inline;
    margin: 5px;
  }
)