tt_content.tx_contentdesigner_googleStaticImage < plugin.tx_contentdesigner
tt_content.tx_contentdesigner_googleStaticImage.settings {
  title       = LLL:EXT:content_designer/Resources/Private/Language/locallang_db.xml:googlestatic_title
  description = LLL:EXT:content_designer/Resources/Private/Language/locallang_db.xml:googlestatic_description
  
  icon      = ../typo3conf/ext/content_designer/Resources/Public/Icons/GoogleStaticImage/ce_wiz.gif
  iconSmall = ../typo3conf/ext/content_designer/Resources/Public/Icons/GoogleStaticImage/ext_icon.gif
  
  previewObj = COA
  previewObj {
	  #10       = TEXT
	  #10.field = header
	  #10.wrap  = <p><strong>|</strong></p>
	
	  20            = TEXT
	  20.value      = {field:street}, {field:city}
	  20.insertData = 1
	  20.wrap       = <p>|</p>
  }
  
  cObject {
    sDEF {
      sheetTitle = LLL:EXT:content_designer/Resources/Private/Language/locallang_db.xml:sheet_general
      
      el {
        street {
          label = LLL:EXT:content_designer/Resources/Private/Language/locallang_db.xml:google_street
          config.type = input
        }
        
        city {
          label = LLL:EXT:content_designer/Resources/Private/Language/locallang_db.xml:google_city
          config.type = input
        }
      }
    }
  }
  
  renderObj = COA
  renderObj {
    20 = IMAGE
    20 {
      wrap = <div class="csc-textpic-imagewrap">|</div><p class="align-right sub" style="padding-right: 12px;">Quelle: Google Maps</p>
      
      file.import.stdWrap.cObject = USER
      file.import.stdWrap.cObject {
        includeLibs = EXT:content_designer/Resources/Private/GoogleStaticImage/user_getextimage.class.php
        userFunc    = user_getExtImage->main
        
        url = TEMPLATE
        url {
          template = TEXT
          template.value = http://maps.google.com/maps/api/staticmap?center=###STREET###,###CITY###&zoom=15&size=###EXT_WIDTH###x###EXT_HEIGHT###&maptype=roadmap&markers=color:red||###STREET###,###CITY###&sensor=false&style=
          template.wrap  = |hue:0x{$tt_content.tx_contentdesigner_googleStaticImage.color}
          
          marks {
            STREET = TEXT
            STREET.field = street
            STREET.wrap = |
            STREET.rawUrlEncode = 1
            
            CITY < .STREET
            CITY.field = city
            
            EXT_WIDTH = TEXT
            EXT_WIDTH.value = 800
            EXT_WIDTH.override.field = extImgWidth
            EXT_WIDTH.override.if.isTrue.field = extImgWidth
            
            EXT_HEIGHT < .EXT_WIDTH
            EXT_HEIGHT.value = 450
            EXT_HEIGHT.override.field = extImgHeight
            EXT_HEIGHT.override.if.isTrue.field = extImgHeight
          }
        }
        
        targetPath   = uploads/tx_contentdesigner/
        fileExt      = jpg
        filename = TEXT
        filename.value = cd_googleMaps
        filename.dataWrap = |_{field:uid}
        cacheTimeout = 900
      }
        
      width.data = register:maxImageWidth
      width.wrap = |c
    
      imageLinkWrap = 1
      imageLinkWrap.enable = 1
      imageLinkWrap.typolink {
        parameter.cObject < tt_content.tx_contentdesigner_googleStaticImage.settings.renderObj.20.file.import.stdWrap.cObject
        ATagParams = class="lightbox" rel="lightbox[{field:uid}]"
      }
    }
  }
}

[globalVar = LIT:1 = {$tt_content.tx_contentdesigner_googleStaticImage.newRenderingEnabled}]
  tt_content.tx_contentdesigner_googleStaticImage.settings.renderObj.20 {
    wrap = <div class="csc-textpic csc-textpic-center csc-textpic-above csc-textpic-border"><div class="csc-textpic-imagewrap"><div class="csc-textpic-center-outer"><div class="csc-textpic-center-inner"><figure class="csc-textpic-image csc-textpic-last">|<figcaption class="csc-textpic-caption">Quelle: Google Maps</figcaption></figure></div></div></div></div>
    
    # Bildformat abhängig der Spalte (in einer anderen TS file geändert: page_setup_images.ts)
    width < tt_content.image.20.maxW
    file.width < tt_content.image.20.maxW
    
    # Klickvergrößerung
    #renderObj.20.imageLinkWrap >
  }
[global]